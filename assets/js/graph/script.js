function dragstarted(e,t){e.active||simulation.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y}function dragged(e,t){t.fx=e.x,t.fy=e.y}function dragended(e,t){e.active||simulation.alphaTarget(0),t.fx=null,t.fy=null}function highlightNode(e){gridSvg.selectAll("rect.cell").classed("highlight",(t=>t.id===e)),gridSvg.selectAll("line.grid-link").classed("highlight",(t=>t.source===e||t.target===e)),matrixSvg.selectAll("rect.matrix-cell").classed("highlight",(t=>{const i=nodeIds.indexOf(t.row.id),l=nodeIds.indexOf(t.col.id);return(t.row.id===e||t.col.id===e)&&1===adjMatrix[i][l]})),matrixSvg.selectAll("text.row-label").classed("highlight",(t=>t===e)),matrixSvg.selectAll("text.col-label").classed("highlight",(t=>t===e)),graphSvg.selectAll("g.node-group").select("circle.node").classed("highlight",(t=>t.id===e)),graphSvg.selectAll("line.link").classed("highlight",(t=>t.source.id===e||t.target.id===e)),graphSvg.selectAll("text.node-label").classed("highlight",(t=>t.id===e)),gridSvg.selectAll(".grid-link").classed("highlight",(t=>t.source.id===e||t.target.id===e))}function highlightEdge(e,t){graphSvg.selectAll("text.node-label").classed("highlight",(i=>i.id===e||i.id===t)),graphSvg.selectAll("line.link").classed("highlight",(i=>i.source.id===e&&i.target.id===t||i.source.id===t&&i.target.id===e)),gridSvg.selectAll("line.grid-link").classed("highlight",(i=>i.source.id===e&&i.target.id===t||i.source.id===t&&i.target.id===e)),gridSvg.selectAll("rect.cell").classed("highlight",(i=>i.id===e||i.id===t)),matrixSvg.selectAll("rect.matrix-cell").classed("highlight",(i=>i.row.id===e&&i.col.id===t||i.row.id===t&&i.col.id===e))}function clearHighlight(){d3.selectAll(".highlight").classed("highlight",!1)}function toggleSelection(e){gridSvg.selectAll("rect.cell").filter((t=>t.id===e)).classed("selected",(function(){return!d3.select(this).classed("selected")})),graphSvg.selectAll("circle.node").filter((t=>t.id===e)).classed("selected",(function(){return!d3.select(this).classed("selected")}))}const svgSize=300,gridSize=4,totalNodes=gridSize*gridSize,matrixCellSize=svgSize/totalNodes,canvasOffset=2*matrixCellSize,margin={top:matrixCellSize,right:matrixCellSize,bottom:0,left:40},svgWidth=svgSize+margin.left+margin.right,svgHeight=svgSize+margin.top+margin.bottom;["#grid","#matrix","#graph"].forEach((e=>{d3.select(e).attr("width",svgWidth).attr("height",svgHeight+2*matrixCellSize)}));let nodes=[];for(let e=0;e<gridSize;e++)for(let t=0;t<gridSize;t++)nodes.push({id:`${e}-${t}`,x:e,y:t});const nodeIds=nodes.map((e=>e.id));let links=[];for(let e=0;e<gridSize;e++)for(let t=0;t<gridSize;t++)for(let i=-1;i<=1;i++)for(let l=-1;l<=1;l++){if(0===i&&0===l)continue;let r=e+i,a=t+l;r<0||a<0||r>=gridSize||a>=gridSize||links.push({source:`${e}-${t}`,target:`${r}-${a}`})}const adjMatrix=Array.from({length:nodeIds.length},(()=>Array(nodeIds.length).fill(0)));links.forEach((e=>{const t=nodeIds.indexOf(e.source),i=nodeIds.indexOf(e.target);adjMatrix[t][i]=1}));const gridSvg=d3.select("#grid"),gridCellSize=svgSize/gridSize,gridGroups=gridSvg.selectAll(".grid-group").data(nodes).enter().append("g").attr("class","grid-group").attr("transform",(e=>`translate(${e.x*gridCellSize+canvasOffset}, ${e.y*gridCellSize+canvasOffset})`)).on("mouseenter",((e,t)=>highlightNode(t.id))).on("mouseleave",clearHighlight).on("click",((e,t)=>toggleSelection(t.id)));gridGroups.append("rect").attr("width",gridCellSize).attr("height",gridCellSize).attr("class","cell"),gridGroups.append("text").attr("class","grid-label").attr("x",gridCellSize/2).attr("y",gridCellSize/2).attr("text-anchor","middle").attr("alignment-baseline","middle").attr("font-size","12px").style("font-weight","bold").style("font-family","SF Mono").text((e=>e.id));const shrinkFactor=.25*gridCellSize,gridLinks=gridSvg.selectAll(".grid-link").data(links).enter().append("line").attr("class","grid-link").attr("x1",(e=>{const t=nodes.find((t=>t.id===e.source)),i=nodes.find((t=>t.id===e.target)),l=i.x-t.x,r=i.y-t.y,a=Math.sqrt(l*l+r*r);return t.x*gridCellSize+gridCellSize/2+canvasOffset+l/a*shrinkFactor})).attr("y1",(e=>{const t=nodes.find((t=>t.id===e.source)),i=nodes.find((t=>t.id===e.target)),l=i.x-t.x,r=i.y-t.y,a=Math.sqrt(l*l+r*r);return t.y*gridCellSize+gridCellSize/2+canvasOffset+r/a*shrinkFactor})).attr("x2",(e=>{const t=nodes.find((t=>t.id===e.target)),i=nodes.find((t=>t.id===e.source)),l=i.x-t.x,r=i.y-t.y,a=Math.sqrt(l*l+r*r);return t.x*gridCellSize+gridCellSize/2+canvasOffset+l/a*shrinkFactor})).attr("y2",(e=>{const t=nodes.find((t=>t.id===e.target)),i=nodes.find((t=>t.id===e.source)),l=i.x-t.x,r=i.y-t.y,a=Math.sqrt(l*l+r*r);return t.y*gridCellSize+gridCellSize/2+canvasOffset+r/a*shrinkFactor})).style("stroke","#000").style("stroke-width",2),matrixSvg=d3.select("#matrix");matrixSvg.selectAll("rect").data(nodes.flatMap((e=>nodes.map((t=>({row:e,col:t})))))).enter().append("rect").attr("x",(e=>e.col.x*gridSize*matrixCellSize+e.col.y*matrixCellSize+canvasOffset)).attr("y",(e=>e.row.x*gridSize*matrixCellSize+e.row.y*matrixCellSize+canvasOffset)).attr("width",matrixCellSize).attr("height",matrixCellSize).attr("class",(e=>{const t=nodeIds.indexOf(e.row.id),i=nodeIds.indexOf(e.col.id);return 1===adjMatrix[t][i]?"matrix-cell edge":"matrix-cell"})).on("mouseenter",((e,t)=>highlightEdge(t.row.id,t.col.id))).on("mouseleave",clearHighlight),matrixSvg.selectAll(".col-label").data(nodeIds).enter().append("text").attr("class","col-label").attr("text-anchor","middle").attr("transform",((e,t)=>`translate(${t*matrixCellSize+matrixCellSize/2+canvasOffset},${matrixCellSize}) rotate(-90)`)).attr("font-size","10px").text((e=>e)).style("font-weight","bold").style("font-family","SF Mono"),matrixSvg.selectAll(".row-label").data(nodeIds).enter().append("text").attr("class","row-label").attr("x",matrixCellSize/2).attr("y",((e,t)=>t*matrixCellSize+matrixCellSize/2+canvasOffset)).attr("text-anchor","start").attr("alignment-baseline","middle").attr("font-size","10px").text((e=>e)).style("font-weight","bold").style("font-family","SF Mono");const graphSvg=d3.select("#graph"),nodeRadius=14,edgeLen=100;let gap=1.5*matrixCellSize;const simulation=d3.forceSimulation(nodes).force("link",d3.forceLink(links).id((e=>e.id)).distance(80)).force("charge",d3.forceManyBody().strength(-80)).force("center",d3.forceCenter(200,200)).force("center",d3.forceCenter(svgWidth/2,canvasOffset/2+svgHeight/2)),link=graphSvg.append("g").selectAll("line").data(links).enter().append("line").attr("class","link"),nodeGroup=graphSvg.selectAll(".node-group").data(nodes).enter().append("g").attr("class","node-group").on("mouseenter",((e,t)=>highlightNode(t.id))).on("mouseleave",clearHighlight).on("click",((e,t)=>toggleSelection(t.id))).call(d3.drag().on("start",dragstarted).on("drag",dragged).on("end",dragended));nodeGroup.append("circle").attr("class","node").attr("r",nodeRadius),nodeGroup.append("text").attr("class","node-label").attr("text-anchor","middle").style("pointer-events","none").attr("alignment-baseline","middle").text((e=>e.id)),simulation.on("tick",(()=>{link.attr("x1",(e=>e.source.x)).attr("y1",(e=>e.source.y)).attr("x2",(e=>e.target.x)).attr("y2",(e=>e.target.y)),nodeGroup.attr("transform",(e=>`translate(${e.x},${e.y})`))}));