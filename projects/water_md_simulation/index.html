<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Molecular Dynamics Simulation | Vidhan Kashyap </title> <meta name="author" content="Vidhan Kashyap"> <meta name="description" content="Introduction to molecular dynamics simulations, covering interatomic potentials, integration algorithms, constraints, periodic boundary conditions, and temperature control methods like velocity scaling."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <meta property="og:site_name" content="Vidhan Kashyap"> <meta property="og:type" content="website"> <meta property="og:title" content="Vidhan Kashyap | Molecular Dynamics Simulation"> <meta property="og:url" content="https://7vidhan.github.io/projects/water_md_simulation/"> <meta property="og:description" content="Introduction to molecular dynamics simulations, covering interatomic potentials, integration algorithms, constraints, periodic boundary conditions, and temperature control methods like velocity scaling."> <meta property="og:locale" content="en"> <meta name="twitter:card" content="summary"> <meta name="twitter:title" content="Molecular Dynamics Simulation"> <meta name="twitter:description" content="Introduction to molecular dynamics simulations, covering interatomic potentials, integration algorithms, constraints, periodic boundary conditions, and temperature control methods like velocity scaling."> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9D%91&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://7vidhan.github.io/projects/water_md_simulation/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Molecular Dynamics Simulation",
            "description": "Introduction to molecular dynamics simulations, covering interatomic potentials, integration algorithms, constraints, periodic boundary conditions, and temperature control methods like velocity scaling.",
            "published": "November 24, 2025",
            "authors": [
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Vidhan</span> Kashyap </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">Projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Misc </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/blog/">Blog</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">Projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/night-sky/">Night Sky</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Molecular Dynamics Simulation</h1> <p>Introduction to molecular dynamics simulations, covering interatomic potentials, integration algorithms, constraints, periodic boundary conditions, and temperature control methods like velocity scaling.</p> </d-title> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#brief-introduction-to-molecular-dynamics">Brief Introduction to Molecular Dynamics</a> </div> <div> <a href="#velocity-integration-verlet-method">Velocity Integration(Verlet Method)</a> </div> <div> <a href="#constraints-in-molecular-dynamics">Constraints in Molecular Dynamics</a> </div> <div> <a href="#periodic-boundary-conditions">Periodic Boundary Conditions</a> </div> <div> <a href="#velocity-scaling">Velocity Scaling</a> </div> </nav> </d-contents> <h2 id="brief-introduction-to-molecular-dynamics">Brief Introduction to Molecular Dynamics</h2> <p>Molecular dynamics simulation consists of the numerical, step-by-step, solution of the classical equations of motion, which for a simple atomic system may be written as</p> \[m_i \, \ddot{\mathbf{r}}_i = \mathbf{f}_i \\ \\\] \[\mathbf{f}_i = -\,\frac{\partial U}{\partial \mathbf{r}_i} \\ \\\] <p>For this purpose we need to be able to calculate the forces \(\mathbf{f}_i\) acting on the atoms, and these are usually derived from a potential energy \(U(\mathbf{r}^N)\), where \(\mathbf{r}^N = (\mathbf{r}_1, \mathbf{r}_2, \ldots, \mathbf{r}_N)\) represents the complete set of \(3N\) atomic coordinates. The Lennard Jones potential is the most commonly used form:</p> \[U_{LJ}(r) = 4\varepsilon \left[ \left( \frac{\sigma}{r} \right)^{12} - \left( \frac{\sigma}{r} \right)^{6} \right],\] <p>with two parameters: \(\sigma\), the effective diameter, and \(\varepsilon\), the well depth. This potential was used, for instance, in the earliest studies of the properties of liquid argon. If electrostatic charges are present, we add the appropriate Coulomb potential</p> \[U_{C}(r) = \frac{1}{4\pi \varepsilon_0} \, \frac{Q_1 Q_2}{r},\] <p>where \(Q_1\) and \(Q_2\) are the charges and \(\varepsilon_0\) is the permittivity of free space.</p> <h2 id="velocity-integrationverlet-method">Velocity Integration(Verlet Method)</h2> <p>The velocity Verlet algorithm is widely used in molecular dynamics because it is time-reversible, symplectic, and provides good energy conservation. It integrates Newton’s equations of motion by updating positions, velocities, and forces in a staggered manner.</p> <p>It works by first advancing the positions using the velocities and accelerations at the current time step, then computing new forces, and finally finishing the velocity update. The velocity Verlet algorithm updates positions and velocities as follows:</p> <h4 id="position-update">Position update</h4> \[\mathbf{r}_i(t+\Delta t) = \mathbf{r}_i(t) + \mathbf{v}_i(t)\,\Delta t + \frac{1}{2}\,\mathbf{a}_i(t)\,\Delta t {2},\] <h4 id="force-evaluation">Force evaluation</h4> \[\mathbf{F}_i(t+\Delta t) = -\,\nabla_i U(\mathbf{r}_1, \ldots, \mathbf{r}_N),\] <h4 id="acceleration-update">Acceleration update</h4> \[\mathbf{a}_i(t+\Delta t) = \frac{\mathbf{F}_i(t+\Delta t)}{m_i},\] <h4 id="velocity-update">Velocity update</h4> \[\mathbf{v}_i(t+\Delta t) = \mathbf{v}_i(t) + \frac{1}{2} \left[\mathbf{a}_i(t) + \mathbf{a}_i(t+\Delta t)\right]\Delta t.\] <h2 id="constraints-in-molecular-dynamics">Constraints in Molecular Dynamics</h2> <p>In many molecular dynamics simulations, certain intramolecular bonds (e.g., the O–H bonds in water) vibrate at very high frequencies. Accurately simulating these vibrations requires very small timesteps, which makes the simulation slow. To avoid this, these bonds are often treated as constraints with fixed lengths. The simulation ensures that these bonds maintain their exact lengths at each timestep, instead of letting them vibrate freely.</p> <p>The bond length constraint can be written as:</p> \[\chi(r_1, r_2) = |r_1 - r_2|^2 - b^2 = 0\] <p>where \(r_1\) and \(r_2\) are the positions of the two atoms and \(b\) is the fixed bond length.</p> <p>How constraints are enforced</p> <ul> <li> <p><strong>SHAKE:</strong> Corrects atomic positions after each timestep so that all constrained bond lengths are exactly satisfied.</p> </li> <li> <p><strong>RATTLE:</strong> Extends SHAKE to the velocity Verlet algorithm by also correcting velocities, ensuring both positions and velocities obey the constraints.</p> </li> </ul> <p><strong>Intuition:</strong> A constrained bond behaves like a rigid rod. Even if numerical integration tries to stretch or compress it, the SHAKE/RATTLE procedure pulls the atoms back to maintain the correct bond length. This allows the use of <strong>larger timesteps</strong> without losing molecular geometry.</p> <p>Given an algebraic relation between two atomic coordinates, for example a fixed bond length \(b\) between atoms 1 and 2, one may write a constraint equation, plus an equation for the time derivative of the constraint:</p> \[\chi(r_1, r_2) = (r_1 - r_2) \cdot (r_1 - r_2) - b^2 = 0 \quad \text{(9a)}\] \[\dot{\chi}(r_1, r_2) = 2(v_1 - v_2) \cdot (r_1 - r_2) = 0 \quad \text{(9b)}\] <p>In the Lagrangian formulation, the constraint forces acting on the atoms enter as:</p> \[m_i \ddot{r}_i = f_i + \Lambda g_i\] <p>where $\Lambda$ is the undetermined multiplier and</p> \[g_1 = - \frac{\partial \chi}{\partial r_1} = -2(r_1 - r_2), \quad g_2 = - \frac{\partial \chi}{\partial r_2} = 2(r_1 - r_2)\] <p>For simplicity, let \((r_1, r_2) \to r\) and \((p_1, p_2) \to p\), etc. Then the RATTLE steps can be written as:</p> <ol> <li>Half-step momentum update with constraint:</li> </ol> \[p\Big(t + \frac{1}{2} \delta t\Big) = p(t) + \frac{1}{2} \delta t \, f(t) + \lambda g(t)\] <ol> <li>Position update:</li> </ol> \[r(t + \delta t) = r(t) + \delta t \, \frac{p(t + \frac{1}{2}\delta t)}{m}\] <p>Choosing \(\lambda\) such that:</p> \[0 = \chi(r(t + \delta t)) \quad \text{(10a)}\] <ol> <li>Full-step momentum update:</li> </ol> \[p(t + \delta t) = p\Big(t + \frac{1}{2}\delta t\Big) + \frac{1}{2} \delta t \, f(t + \delta t) + \mu g(t + \delta t)\] <p>Choosing \(\mu\) such that:</p> \[0 = \dot{\chi}(r(t + \delta t), p(t + \delta t)) \quad \text{(10b)}\] <p>Step (10a) can be implemented by defining unconstrained variables:</p> \[\bar{p}\Big(t + \frac{1}{2}\delta t\Big) = p(t) + \frac{1}{2} \delta t \, f(t), \quad \bar{r}(t + \delta t) = r(t) + \delta t \, \frac{\bar{p}(t + \frac{1}{2} \delta t)}{m}\] <p>Then solve the nonlinear equation for \(\lambda\):</p> \[\chi(t + \delta t) = \chi\Big(\bar{r}(t + \delta t) + \lambda \delta t \frac{g(t)}{m}\Big) = 0\] <p>and substitute back:</p> \[p\Big(t + \frac{1}{2} \delta t\Big) = \bar{p}\Big(t + \frac{1}{2} \delta t\Big) + \lambda g(t), \quad r(t + \delta t) = \bar{r}(t + \delta t) + \delta t \frac{\lambda g(t)}{m}\] <p>Step (10b) can be handled by defining:</p> \[\bar{p}(t + \delta t) = p\Big(t + \frac{1}{2}\delta t\Big) + \frac{1}{2} \delta t \, f(t + \delta t)\] <p>Then solve for the second Lagrange multiplier \(\mu\):</p> \[\dot{\chi}(t + \delta t) = \dot{\chi}\Big(r(t + \delta t), \bar{p}(t + \delta t) + \mu g(t + \delta t)\Big) = 0\] <p>(which is linear since \(\dot{\chi}(r, p) = - g(r) \cdot p / m\)) and substitute back:</p> \[p(t + \delta t) = \bar{p}(t + \delta t) + \mu g(t + \delta t)\] <h2 id="periodic-boundary-conditions">Periodic Boundary Conditions</h2> <p>In molecular dynamics simulations, small sample sizes can lead to significant surface effects. For example, in a cube of 1000 atoms arranged in a \(10 \times 10 \times 10\) lattice, nearly half of the atoms are on the outer faces, affecting the measured properties. Even for \(10^6 = 100^3\) atoms, surface atoms account for 6% of the total, which is still significant.</p> <p>To address this, <strong>periodic boundary conditions (PBCs)</strong> are used. The simulation box is surrounded by replicas of itself, so each atom interacts with the nearest image of other atoms in the periodic array (minimum image convention), provided the potential range is not too long.</p> <p>During the simulation, if an atom leaves the primary box, it re-enters from the opposite side. This ensures continuity and reduces surface effects. However, it is important to remember the artificial periodicity when analyzing properties influenced by long-range correlations, especially for charged or dipolar systems.</p> <h2 id="velocity-scaling">Velocity Scaling</h2> <p>Velocity scaling is a simple method used to control the temperature of a molecular dynamics simulation. In classical MD, the instantaneous temperature \(T\) is related to the kinetic energy \(K\) of the system:</p> \[T = \frac{2 K}{3 N k_B},\] <p>where \(N\) is the number of particles and \(k_B\) is the Boltzmann constant.</p> <p>In velocity scaling, the velocities of all atoms are scaled by a factor \(\alpha\):</p> \[\vec{v}_i \rightarrow \alpha \vec{v}_i,\] <p>where the scaling factor is chosen to bring the instantaneous temperature \(T_{\text{inst}}\) closer to the desired temperature \(T_0\):</p> \[\alpha = \sqrt{\frac{T_0}{T_{\text{inst}}}}.\] <p>This method is straightforward and helps maintain the target temperature, but it does not generate a correct canonical ensemble. More advanced thermostats like Nosé-Hoover or Langevin are typically used for rigorous temperature control.</p> <hr> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Vidhan Kashyap. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?4d5a7d7cac4af05be761327de30b4516"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?b78cb42895d74e4fd6de6f633edcf181" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> </body> </html>